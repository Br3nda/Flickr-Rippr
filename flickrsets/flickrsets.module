<?php
function flickrsets_flickrrippr_node_alter($node, $details) {
  //TODO make the tags a hook
  if (variable_get('flickrsets_import', FALSE)) {
    $vocab = variable_get('flickrsets_vocab', 0);
    if (!$vocab) {
      return;
    }
    flickrsets_vocab($node->nid, $details);
  }
}

function flickrsets_vocab($nid, $details) {
  drupal_set_message('TODO');
}

function flickrsets_form_alter(&$form, &$form_state, $form_id) {
  if('flickrrippr_admin_settings_form' != $form_id) {
    return;
  }

  $options = array();
  foreach(taxonomy_get_vocabularies() as $v) {
    $options[$v->vid] = $v->name; 
  }
  $form['sets'] = array(
    '#type' => 'fieldset',
    '#title' => t('Sets'),
    '#weight' => -1,
    'flickrsets_import' => array(
      '#title' => t('Import sets?'),
      '#type' => 'checkbox',
      '#default_value' => variable_get('flickrsets_import', FALSE),
    ),
    'flickrsets_vocab' => array(
      '#title' => t('Vocab for sets'),
      '#type' => 'select',
      '#description' => t('You may need to create a new vocab at !link', array('!link' => l('Taxonomy Admin', 'admin/content/taxonomy'))),
      '#options' => $options,
      '#default_value' => variable_get('flickrsets_vocab', 0),
    ),
  );

  $form['#validate'][] = 'flickrsets_admin_validate'; 
  $form['#submit'][] = 'flickrsets_admin_submit';  
}

function flickrsets_admin_validate($form, &$form_state) {
//   drupal_set_message(__FUNCTION__);
}

function flickrsets_admin_submit($form, &$form_state) {
  $import = $form_state['values']['flickrsets_import'];
  variable_set('flickrsets_import', $import);

  $vocab = $form_state['values']['flickrsets_vocab'];
  variable_set('flickrsets_vocab', $vocab);
}